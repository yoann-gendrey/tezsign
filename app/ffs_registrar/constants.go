package main

import "github.com/tez-capital/tezsign/app/gadget/common"

const (
	FunctionName = "ffs.tezsign"

	// usb_ctrlrequest constants
	evSize            = 12
	evTypeBind        = 0
	evTypeUnbind      = 1
	evTypeEnable      = 2
	evTypeDisable     = 3
	evTypeSetup       = 4
	evTypeSuspend     = 5
	evTypeResume      = 6
	vendorReqReady    = 0x5A
	bmReqTypeVendorIn = 0x81
	protoVersion      = 0x0001
)

var (
	Ep0Path = common.FfsInstanceRoot + "/ep0"

	// Descriptors for one interface (IF0)
	// deviceDescriptors = []byte{
	// 	0x03, 0x00, 0x00, 0x00, // fs magic (V2)
	// 	0x42, 0x00, 0x00, 0x00, // total length
	// 	0x03, 0x00, 0x00, 0x00, // flags: HAS_FS_DESC | HAS_HS_DESC
	// 	0x03, 0x00, 0x00, 0x00, // fs_count = 3 descriptors (IF + 2 EPs)
	// 	0x03, 0x00, 0x00, 0x00, // hs_count = 3 descriptors (IF + 2 EPs)

	// 	// FS set (3 descriptors = 9 + 7 + 7 = 23 bytes)
	// 	0x09, 0x04, 0x00, 0x00, 0x02, 0xFF, 0x00, 0x00, 0x01, // Interface #0, 2 EPs, vendor, iInterface=1
	// 	0x07, 0x05, 0x81, 0x02, 0x40, 0x00, 0x00, // EP1 IN  bulk, wMaxPacket=64
	// 	0x07, 0x05, 0x02, 0x02, 0x40, 0x00, 0x00, // EP2 OUT bulk, wMaxPacket=64

	// 	// HS set (3 descriptors = 9 + 7 + 7 = 23 bytes)
	// 	0x09, 0x04, 0x00, 0x00, 0x02, 0xFF, 0x00, 0x00, 0x01, // Interface #0, 2 EPs, vendor, iInterface=1
	// 	0x07, 0x05, 0x81, 0x02, 0x00, 0x02, 0x00, // EP1 IN  bulk, wMaxPacket=512
	// 	0x07, 0x05, 0x02, 0x02, 0x00, 0x02, 0x00, // EP2 OUT bulk, wMaxPacket=512
	// }

	// Descriptors for 2 active interfaces (IF0 & IF1)
	deviceDescriptors = []byte{
		0x03, 0x00, 0x00, 0x00, // fs magic (V2)
		0x70, 0x00, 0x00, 0x00, // total length = 112 bytes
		0x03, 0x00, 0x00, 0x00, // flags: HAS_FS_DESC | HAS_HS_DESC
		0x06, 0x00, 0x00, 0x00, // fs_count = 6 descriptors (IF0+2EP, IF1+2EP)
		0x06, 0x00, 0x00, 0x00, // hs_count = 6 descriptors (IF0+2EP, IF1+2EP)

		// FS set (2 interfaces, each: IF + 2 EPs =2 x (9 + 7 + 7)= 46 bytes)
		0x09, 0x04, 0x00, 0x00, 0x02, 0xFF, 0x00, 0x00, 0x01, // Interface #0, alt=0, 2 EPs, vendor-specific, iInterface=1
		0x07, 0x05, 0x81, 0x02, 0x40, 0x00, 0x00, // EP1 IN  bulk, wMaxPacket=64
		0x07, 0x05, 0x02, 0x02, 0x40, 0x00, 0x00, // EP2 OUT bulk, wMaxPacket=64

		0x09, 0x04, 0x01, 0x00, 0x02, 0xFF, 0x00, 0x00, 0x02, // Interface #1, alt=0, 2 EPs, vendor, iInterface=2
		0x07, 0x05, 0x83, 0x02, 0x40, 0x00, 0x00, // EP3 IN  bulk, wMaxPacket=64
		0x07, 0x05, 0x04, 0x02, 0x40, 0x00, 0x00, // EP4 OUT bulk, wMaxPacket=64

		// HS set (2 interfaces, each: IF + 2 EPs =2 x (9 + 7 + 7)= 46 bytes))
		0x09, 0x04, 0x00, 0x00, 0x02, 0xFF, 0x00, 0x00, 0x01, // Interface #0, 2 EPs, vendor, iInterface=1
		0x07, 0x05, 0x81, 0x02, 0x00, 0x02, 0x00, // EP1 IN  bulk, wMaxPacket=512
		0x07, 0x05, 0x02, 0x02, 0x00, 0x02, 0x00, // EP2 OUT bulk, wMaxPacket=512

		0x09, 0x04, 0x01, 0x00, 0x02, 0xFF, 0x00, 0x00, 0x02, // Interface #1, 2 EPs, vendor, iInterface=2
		0x07, 0x05, 0x83, 0x02, 0x00, 0x02, 0x00, // EP3 IN  bulk, wMaxPacket=512
		0x07, 0x05, 0x04, 0x02, 0x00, 0x02, 0x00, // EP4 OUT bulk, wMaxPacket=512
	}

	// V1 Strings for one interface (IF0)
	// deviceStrings = []byte{
	// 	0x02, 0x00, 0x00, 0x00, // FUNCTIONFS_STRINGS_MAGIC
	// 	0x1A, 0x00, 0x00, 0x00, // total length 26 bytes
	// 	0x01, 0x00, 0x00, 0x00, // 1 string
	// 	0x01, 0x00, 0x00, 0x00, // 1 language

	// 	// string 0: language
	// 	0x09, 0x04, // English (US)
	// 	// USB{space}Filter\0
	// 	0x74, 0x65, 0x7A, 0x73, 0x69, 0x67, 0x6E, 0x00,
	// }

	// V1 Strings for one interface (IF0 & IF1)
	deviceStrings = []byte{
		0x02, 0x00, 0x00, 0x00, // FUNCTIONFS_STRINGS_MAGIC
		0x26, 0x00, 0x00, 0x00, // total length = 38 bytes
		0x02, 0x00, 0x00, 0x00, // 2 strings per language (iInterface=1,2)
		0x01, 0x00, 0x00, 0x00, // 1 language

		// language 0: en-US
		0x09, 0x04, // LANGID 0x0409

		// string #1: "tezsign-0\0"
		0x74, 0x65, 0x7A, 0x73, 0x69, 0x67, 0x6E, 0x2D, 0x30, 0x00,

		// string #2: "tezsign-1\0"
		0x74, 0x65, 0x7A, 0x73, 0x69, 0x67, 0x6E, 0x2D, 0x31, 0x00,
	}
)
